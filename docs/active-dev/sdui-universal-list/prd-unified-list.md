# PRD: Unified Chat & List Architecture

## Business Outcome
- **Measurable impact:** Increase daily active user (DAU) retention by 15% and increase cross-category purchases (e.g., users buying both groceries and high-ticket items).
- **Success criteria:** Zero regression in Pop user engagement metrics; 50% of active BuyAnything users adopt the new unified list within 30 days of feature flag rollout.
- **Target users:** All users across both "Pop" (budget optimizing) and "BuyAnything" (high-ticket/service) personas.

## Scope
- **In-scope:** Transitioning the entire frontend experience to a two-pane (Chat + List) mobile-first layout. Allowing users to maintain multiple shareable lists (`Projects`) with a sticky "Default Groceries" list for every user. Implementing "Zero-Shame" UX principles where $5 items and $5M items exist in the same visual hierarchy. Supporting EA/Principal delegation with approval-gated read-only sharing. Implementing the viral referral growth loop (30% of **swap payouts only** to the referrer — see PRD §6.2). Affiliate CPA, escrow take-rate, and tips are excluded from rev share.
- **Out-of-scope:** The backend logic that dynamically renders the items (this is handled in `prd-sdui-comparison.md`). The SDUI blocks that power the list header (tip jar, onboarding) are defined in `prd-sdui-comparison.md` under the `Project.ui_schema` contract.

## User Flow
1. User opens the public site and enters the authenticated app workspace route (not the public home page), then lands on their **sticky "Default Groceries" list** alongside a chat input. (Every user gets one automatically.)
2. User asks the agent to find an item (e.g., "Find me cheap paper towels" or "Charter a jet to Aspen").
3. The chat confirms understanding, and a new "Row" instantly appears on the list indicating a search is in progress.
4. User can share the URL of this list with a collaborator (spouse, assistant) to view or edit together.
5. **EA/Principal flow:** An EA can build a list in full edit mode, then share a read-only or approval-gated link with the Principal, who can approve actions but not modify the list.
6. **Viral loop:** When a new user signs up via a shared list link, the referrer earns 30% of all swap payouts generated by that new user.

## Business Requirements

### Authentication & Authorization
- **Who needs access?** Registered users and invited collaborators.
- **What actions are permitted?** List owners can add/remove items and invite members. Invited members inherit access based on their `ProjectMember.role`: `"owner"` (full edit), `"member"` (read/write), or `"viewer"` (read-only, approval-gated — for EA/Principal delegation).
- **What data is restricted?** Lists are strictly private unless explicitly shared via collaboration links. Shared-link viewers can see bids and click affiliate links but cannot modify the list.

### Monitoring & Visibility
- **What business metrics matter?** DAU, List creation rate, collaboration link share rate, cross-category request rate.
- **What operational visibility is needed?** Page load times for the list view, WebSocket/SSE connection stability for live list updates.
- **What user behavior needs tracking?** Which items are added to which lists, frequency of switching between lists.

### Billing & Entitlements
- **How is this monetized?** N/A for the list structure itself (monetization happens via item actions).
- **What entitlement rules apply?** No paywalls for creating or sharing lists.
- **What usage limits exist?** Standard anti-abuse rate limits on list creation and sharing endpoints.

## Data Requirements
- **What information must persist?** `Projects` (lists), user membership (`ProjectMember`), invite tokens (`ProjectInvite`), and referral attribution (`User.signup_source`, `User.referral_share_token`).
- **How long must data be retained?** Indefinitely, until explicitly deleted by the user.
- **Project-level UI:** `Project.ui_schema` (JSONB) stores the list header — tip jar, savings stats, onboarding prompts, share actions. Regenerated on status changes (purchases, new members, first item). See Schema Spec §6.
- **Referral tracking:** When a user signs up via a shared list URL, the system must persist the referrer's identity and route 30% of subsequent swap payouts to them.

### Performance Expectations
- **What response times are acceptable?** Initial list load <500ms. Real-time updates via SSE must reflect on the screen in <100ms.
- **SSE reconnection:** On page load or reconnect after mobile backgrounding, the frontend must fetch the current persisted state via standard GET requests. SSE is for real-time pushes only — the frontend must not rely on SSE to backfill missed events. (See Schema Spec §9.)
- **What availability is required?** 99.9% uptime for core list reading/writing.

### UX & Accessibility
- **What user experience standards apply?** Zero-Shame UX (premium feel for all items), mobile-first bottom navigation, desktop split-pane.
- **What accessibility requirements?** WCAG AA compliance, full screen-reader support for list traversal.
- **What devices/browsers must be supported?** iOS Safari, Android Chrome, modern desktop browsers.

### Privacy, Security & Compliance
- **What data protection is required?** UHNW user lists require strict confidentiality; vendor names in chat must respect NDA requirements.

## Dependencies
- **Upstream:** None. This is the foundational layout.
- **Downstream:** Requires `prd-sdui-comparison.md` to actually render the contents of the lists.

## Risks & Mitigations
- **Risk:** Existing BuyAnything users reject the vertical list format in favor of the old horizontal board.
- **Mitigation:** Roll out via an opt-in feature flag first. Monitor engagement metrics before deprecating the old board.

## Acceptance Criteria (Business Validation)
- [ ] Initial list load time ≤500ms (baseline and target to be validated during Phase 1 instrumentation).
- [ ] List sharing link successfully grants access to a new user post-signup, with referral attribution persisted.
- [ ] Mobile view correctly displays Chat and List as separate, easily navigable tabs.
- [ ] EA/Principal: A "viewer" role member can see all bids and click affiliate links but cannot add/remove items or claim swaps.
- [ ] Referral: When a referred user claims a swap, 30% of the payout is credited to the referrer's wallet.

## Traceability
- Parent PRD: `docs/active-dev/sdui-universal-list/parent.md`
